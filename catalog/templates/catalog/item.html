{% extends 'base.html' %}

{% load mptt_tags %}

{% block content %}
	<div class="span-6 colborder">
		<ul>
			<li>
				<a href="{% url catalog-root %}">Каталог</a>
			</li>
			<ul>
	{% block catalog_tree %}
		{% full_tree_for_model catalog.TreeItem as catalog_tree %}
		{% for catalog_tree_element,structure in catalog_tree|tree_info %}
			{% if catalog_tree_element.level != 0 %}
				{% for item_ancestor in object.tree.get.get_ancestors %}
					{% if item_ancestor == catalog_tree_element %}
						<li style="margin-left: {{ catalog_tree_element.level }}em;">
							<a href="{{ catalog_tree_element.content_object.get_absolute_url }}">{{ catalog_tree_element }}</a>
						</li>
						{% if forloop.last %}
							{% for child in object.tree.get.parent.get_children %}
								{% if object.tree.get == child %}
								<li style="margin-left: {{ child.level }}em;">
									<strong><a href="{{ child.content_object.get_absolute_url }}">{{ child }}</a></strong>
								</li>
								{% else %}
								<li style="margin-left: {{ child.level }}em;">
									<a href="{{ child.content_object.get_absolute_url }}">{{ child }}</a>
								</li>
								{% endif %}
							{% endfor %}
						{% endif %}
					{% endif %}
				{% endfor %}
				{% if object.tree.get.get_ancestors|length == 1 and object.tree.get == catalog_tree_element %}
					{% for item_child in object.tree.get.parent.get_children %}
						{% if object.tree.get == item_child %}
						<li style="margin-left: {{ item_child.level }}em;">
							<strong><a href="{{ item_child.content_object.get_absolute_url }}">{{ item_child }}</a></strong>
						</li>
						{% else %}
						<li style="margin-left: {{ item_child.level }}em;">
							<a href="{{ item_child.content_object.get_absolute_url }}">{{ item_child }}</a>
						</li>
						{% endif %}
					{% endfor %}
				{% endif %}
			{% else %}
				<li style="margin-left: {{ catalog_tree_element.level }}em;">
					<a href="{{ catalog_tree_element.content_object.get_absolute_url }}">{{ catalog_tree_element }}</a>
				</li>
				{% if object.tree.get == catalog_tree_element %}
					{% for item_child in object.tree.get.get_children %}
						<li style="margin-left: {{ item_child.level }}em;">
							<a href="{{ item_child.content_object.get_absolute_url }}">{{ item_child }}</a>
						</li>
					{% endfor %}
				{% endif %}
			{% endif %}
		{% endfor %}
	{% endblock %}
	</ul>
	</div>

	<div class="span-15 last">
		{% include 'catalog/item_breadcrumbs.html' %}
		<hr>
		<div class="span-2">
		{% if object.images.count %}
		    <img src="{{ object.images.all.0.image.url }}" />
		{% endif %}
		</div>
		<div class="span-13 last">
			Название: {{ object.name }}<br>
			Описание: {{ object.description|default:"Описание не доступно" }}<br>
			<a href="{{ object.get_absolute_url }}">Прямая ссылка на этот товар</a>
			<br><br>
			{% if item.content_object.images > 1 %}
				<p>Другие изображения товара</p>
				{% for image in object.images.all %}
				{% if forloop.last %}
				<div class="span-2 last">
				{% else %}
				<div class="span-2 colborder">
				{% endif %}
					<img src="{{ image.image.url }}" />
				</div>
				{% endfor %}
			{% endif %}
		</div>
	</div>
{% endblock %}